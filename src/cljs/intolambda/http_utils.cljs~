(ns intolambda.http-utils
  (:require [ajax.core :refer [GET POST]]))

(defn- cljs->json [data]
  (.stringify js/JSON (clj->js data)))

(defn call-get [url handler-fn error-handler-fn]
  (GET url
       {:handler handler-fn
        :error-handler error-handler-fn
        :with-credentials false
        :headers {
                  "Access-Control-Allow-Origin" "*"
                  "Access-Control-Allow-Headers" "Origin, Content-Type, X-Auth-Token"
                  "Authorization" "Negotiate"
                  "Content-type" "application/json; charset=utf-8"
                  "'Access-Control-Allow-Methods" "GET, POST, PATCH, PUT, DELETE, OPTIONS"
                  }}))

(defn call-post [url message-map handler-fn error-handler-fn]
  (POST url
        {:params {:message (cljs->json message-map)}
         :handler handler-fn
         :error-handler error-handler-fn
         :format :json}))
